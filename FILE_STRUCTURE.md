# Facebook Marketplace Scraper - File Structure

‡πÄ‡∏°‡∏∑‡πà‡∏≠ DAG ‡∏£‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå 2 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏ô MinIO:

## üìÇ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå

```
marketplace-data/
‚îú‚îÄ‚îÄ hourly/                           # ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (Replace)
‚îÇ   ‚îú‚îÄ‚îÄ marketplace_20251122_00.csv   # 00:00-00:59
‚îÇ   ‚îú‚îÄ‚îÄ marketplace_20251122_01.csv   # 01:00-01:59
‚îÇ   ‚îú‚îÄ‚îÄ marketplace_20251122_02.csv   # 02:00-02:59
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îî‚îÄ‚îÄ daily/                            # ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (Append + Dedup)
    ‚îú‚îÄ‚îÄ marketplace_20251122.csv      # ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô)
    ‚îú‚îÄ‚îÄ marketplace_20251123.csv      # ‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ
    ‚îî‚îÄ‚îÄ ...
```

## üîÑ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

### üìÅ Hourly File (‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
- **‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:** `hourly/marketplace_YYYYMMDD_HH.csv`
- **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£:** **Replace** - ‡∏ñ‡πâ‡∏≤ run ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô 1 ‡∏ä‡∏°. ‡∏à‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°
- **‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
- **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
  ```
  marketplace_20251122_09.csv  ‚Üê ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á 09:00-09:59
  ```

### üìÅ Daily File (‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)
- **‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:** `daily/marketplace_YYYYMMDD.csv`
- **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£:** **Append + Dedup** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ‡πÅ‡∏ï‡πà‡∏•‡∏ö URL ‡∏ã‡πâ‡∏≥‡∏≠‡∏≠‡∏Å
- **‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ URL ‡∏ã‡πâ‡∏≥
- **‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
  ```
  Run 1 (09:00): 10 rows
  Run 2 (10:00): 10 rows ‚Üí total 20 rows (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)
  Run 3 (11:00): 10 rows ‚Üí total 28 rows (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ 8 URL ‡πÉ‡∏´‡∏°‡πà, 2 URL ‡∏ã‡πâ‡∏≥)
  ```

## üìä ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### Trigger DAG ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1 (09:00)
```
scraped: 10 items
hourly/marketplace_20251122_09.csv ‚Üí 10 rows
daily/marketplace_20251122.csv ‚Üí 10 rows (‡πÉ‡∏´‡∏°‡πà)
```

### Trigger DAG ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2 (09:30 - ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
```
scraped: 10 items
hourly/marketplace_20251122_09.csv ‚Üí 10 rows (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà)
daily/marketplace_20251122.csv ‚Üí 18 rows (‡πÄ‡∏û‡∏¥‡πà‡∏° 8 URL ‡πÉ‡∏´‡∏°‡πà, 2 URL ‡∏ã‡πâ‡∏≥‡∏ñ‡∏π‡∏Å‡∏•‡∏ö)
```

### Trigger DAG ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 3 (10:00 - ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÉ‡∏´‡∏°‡πà)
```
scraped: 10 items
hourly/marketplace_20251122_10.csv ‚Üí 10 rows (‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà)
daily/marketplace_20251122.csv ‚Üí 25 rows (‡πÄ‡∏û‡∏¥‡πà‡∏° 7 URL ‡πÉ‡∏´‡∏°‡πà)
```

## üîç ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Duplicate

- ‡πÉ‡∏ä‡πâ **URL** ‡πÄ‡∏õ‡πá‡∏ô unique key
- `drop_duplicates(subset=['url'], keep='last')` = ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡πâ‡∏≤ URL ‡∏ã‡πâ‡∏≥

## üìã Columns ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå

```csv
title,price,location,url,image_url,scraped_at,keyword,search_location,radius_km,condition,description
```

## üí° Use Cases

### 1. ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
‚Üí ‡πÉ‡∏ä‡πâ **Hourly File** ‡∏Ç‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

### 2. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô
‚Üí ‡πÉ‡∏ä‡πâ **Daily File** (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥)

### 3. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
‚Üí ‡πÉ‡∏ä‡πâ **Hourly Files** ‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡πÑ‡∏ü‡∏•‡πå

### 4. Track ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
‚Üí ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Daily File ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô

## ‚öôÔ∏è Configuration

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô DAG parameters:
```python
params={
    'keyword': 'iphone 13',
    'location': 'bangkok',
    'radius': 20,
    'max_items': 10,
    'fetch_details': True,
    'email': 'your_email',
    'password': 'your_password'
}
```

## üîê Security Note

**‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Å‡πá‡∏ö email/password ‡πÉ‡∏ô DAG file ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á!

‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ:
1. **Airflow Variables:** Admin > Variables
2. **Airflow Connections:** Admin > Connections
3. **Environment Variables:** ‡πÉ‡∏ô docker-compose.yml

---

**Schedule:** ‡∏£‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (`0 * * * *`)
**Retention:** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏á‡πÉ‡∏ô MinIO (lifecycle policies)
